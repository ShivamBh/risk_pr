{% extends "base.html" %}
{% load static %}

{% block title %}{{ country.name }}- Detail {% endblock %}


{% block header %}
	<nav class="side-nav">
		<div class="nav-menu">
			<div class="nav-items">
				<a href="{% url "report_list" %}" class="nav-links">Reports</a>
			</div>
			<div class="nav-items">
				<a href="{% url "home" %}" class="nav-links">Countries</a>
			</div>
		</div>
	</nav>

{% endblock %}


{% block content %}

	<main class="container">
		
		<section class="header-wrapper">
			<div class="section-header">
				<h1>{{ country.name }}</h1>
			</div>
			<div class="search">
				<form action="{% url 'report_search' %}" id="search-form" method="get" accept-charset="utf-8">
					<button class="search-button" type="submit">
						<i class="fa fa-search" aria-hidden="true"></i>
					</button>
					<input type="text" class="search-field" id="searchbox" name="q" placeholder="Search">
				</form>
			</div>
			
		</section>

		<section class="content-wrapper">

			<div class="main-content">
				<!-- <div class="main-header">
					<h2 class="main-header-text"><span class="country-name-header">
						{{ country.name }}
					</span></h2>

				</div> -->

				<div class="country-detail-wrapper">

					<div class="ratings">
						<div class="country-rating">
							<div class="rating-wrapper">
								<div class="rating-item">
									<div class="rating-name">
										<h3>Political</h3>
									</div>
									<div class="rating-color" id="pol-rat">
										<h6>{{ country.political_rating }}</h6>
									</div>
								</div>
								<div class="rating-item">
									<div class="rating-name">
										<h3>Terror</h3>
									</div>
									<div class="rating-color">
										<h6>{{ country.terror_rating }}</h6>
									</div>
								</div>
								<div class="rating-item">
									<div class="rating-name">
										<h3>Security</h3>
									</div>
									<div class="rating-color">
										<h6>{{ country.security_rating }}</h6>
									</div>
								</div>
								<div class="rating-item">
									<div class="rating-name">
										<h3>Travel</h3>
									</div>
									<div class="rating-color">
										<h6>{{ country.travel_rating }}</h6>
									</div>
								</div>
							</div>
							<div class="legend-wrapper">

								<div class="rating-legend-item">
									<div class="item-color-low color"></div>
									<div class="item-text">
										<p>Low</p>
									</div>
								</div>
								<div class="rating-legend-item">
									<div class="item-color-medium color"></div>
									<div class="item-text">
										<p>Medium</p>
									</div>
								</div>
								<div class="rating-legend-item">
									<div class="item-color-high color"></div>
									<div class="item-text">
										<p>High</p>
									</div>
								</div>
								<div class="rating-legend-item">
									<div class="item-color-extreme color"></div>
									<div class="item-text">
										<p>Extreme</p>
									</div>
								</div>

							</div>
						</div>

						<div class="security-level">
							<div class="sec-level-header">
								<h3>Security Preparedness Level</h3>

							</div>
							<div class="sec-level-rating">
								<div class="sec-level-rating-text">
									<h3>{{ country.sec_level }}</h3>
								</div>
								<div class="sec-level-rating-color"></div>
							</div>
							<div class="sec-level-legend">
								<div class="level-table">
									<div class="level-row">
										<h5>Green : <span class="level-light-text">
											Monitor
										</span></h5>
									</div>
									<div class="level-row">
										<h5>Yellow : <span class="level-light-text">
											Review security posture
										</span></h5>
									</div>
									<div class="level-row">
										<h5>Amber : <span class="level-light-text">
											Prepare emergency response option
										</span></h5>
									</div>
									<div class="level-row">
										<h5>Red : <span class="level-light-text">
											Adopt emergency options
										</span></h5>
									</div>
								</div>
							</div>

						</div>
					</div>
					<div class="country-bg">
						<div class="country-bg-header">
							<h2>Country Background :</h2>
						</div>
						<div class="country-bg-text">
							<p>{{ country.risk_bg }}</p>
						</div>
					</div>
					<div class="maps-wrapper">
						<div class="country-maps-header">
							<h2>Map View :</h2>
						</div>
						<div class="country-map-area">
							<div id="country-maps"></div>
						</div>
						{% if rel_reps %}
						<div class="rel-reps">
							{% for report in rel_reps %}
								<span class="rel">{{ report.latitude }} {{ report.longitude }}</span>
							{% endfor %}
						</div>
						{% endif %}
					</div>
					
				</div>
			</div>

		</section>
	</main>



	<script>

		function countryMap() {

			function getCoordinates(latLngList) {
				var i = 0;
				co_list = latLngList
				var arr = []
				
				for(i = 0; i < latLngList.length; i++) {
					var co_arr = [];
					var co_data = {};
					for(var j = 0; j < 1 ; j++) {
						co_data = {
							lat: Number(latLngList[i].innerHTML.split(" ")[j]),
							lng: Number(latLngList[i].innerHTML.split(" ")[j+1])
						};
					}
					arr.push(co_data);
				}

				return arr;

			}
			

			var latlng = document.querySelectorAll(".rel");
			var x = Number(latlng[1].innerHTML.split(" ")[0]);

			locList = getCoordinates(latlng);
			console.log(locList[1].lat);

			var loc = locList[0];
			var mapOpts = {
				zoom: 2,
				center: loc,
				mapTypeId: google.maps.MapTypeId.HYBRID
			};

			var map = new google.maps.Map(document.getElementById("country-maps"), mapOpts);
			var marker = new google.maps.Marker({position:loc});
			 marker.setMap(map);
			

			for( var i = 0; i < locList.length; i++ ) {
				var position = new google.maps.LatLng(locList[i].lat, locList[i].lng);
				var marker = new google.maps.Marker({
					position: position,
					map: map
				});
				marker.setMap(map);
			}

			google.maps.event.addDomListener(window, 'load', countryMap);

google.maps.event.addDomListener(window, 'resize', function() {
    var center = map.getCenter();
    google.maps.event.trigger(map, 'resize');
    map.setCenter(center);
});

		}

		





	</script>

	<!-- MAPS API -->
         <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBMySJy-jCub2jfs6z-cX5c6k55Ks3yRC4&callback=countryMap"
  type="text/javascript"></script>

	
{% endblock %}
